From ff27f6a43aa188a79722b4dd87638ac8e9d9e520 Mon Sep 17 00:00:00 2001
From: "Sascha Kuehndel (InuSasha)" <dev@inusasha.de>
Date: Sun, 7 May 2017 17:09:00 +0200
Subject: [PATCH] syncthing: configure target with go:host instead of system go

---
 packages/addons/service/syncthing/package.mk | 24 ++++++++++++------------
 1 file changed, 12 insertions(+), 12 deletions(-)

diff --git a/packages/addons/service/syncthing/package.mk b/packages/addons/service/syncthing/package.mk
index f63adb0629..25ea531ac8 100644
--- a/packages/addons/service/syncthing/package.mk
+++ b/packages/addons/service/syncthing/package.mk
@@ -18,7 +18,7 @@
 
 PKG_NAME="syncthing"
 PKG_VERSION="0.14.3"
-PKG_REV="104"
+PKG_REV="105"
 PKG_ARCH="any"
 PKG_LICENSE="MPLv2"
 PKG_SITE="https://syncthing.net/"
@@ -35,7 +35,17 @@ PKG_ADDON_TYPE="xbmc.service"
 PKG_MAINTAINER="Anton Voyl (awiouy)"
 
 configure_target() {
-  go run build.go assets
+  export GOOS=linux
+  export CGO_ENABLED=1
+  export CGO_NO_EMULATION=1
+  export CGO_CFLAGS=$CFLAGS
+  export LDFLAGS="-w -linkmode external -extldflags -Wl,--unresolved-symbols=ignore-in-shared-libs -extld $CC -X main.Version=v$PKG_VERSION"
+  export GOLANG=$TOOLCHAIN/lib/golang/bin/go
+  export GOPATH=$PKG_BUILD/src/github.com/syncthing/syncthing:$PKG_BUILD/vendor:$PKG_BUILD/Godeps/_workspace
+  export GOROOT=$TOOLCHAIN/lib/golang
+  export PATH=$PATH:$GOROOT/bin
+
+  $TOOLCHAIN/lib/golang/bin/go run build.go assets
 
   mkdir -p $PKG_BUILD $PKG_BUILD/src/github.com/syncthing
   ln -fs $PKG_BUILD $PKG_BUILD/src/github.com/syncthing/syncthing
@@ -60,16 +70,6 @@ configure_target() {
       esac
       ;;
   esac
-
-  export GOOS=linux
-  export CGO_ENABLED=1
-  export CGO_NO_EMULATION=1
-  export CGO_CFLAGS=$CFLAGS
-  export LDFLAGS="-w -linkmode external -extldflags -Wl,--unresolved-symbols=ignore-in-shared-libs -extld $CC -X main.Version=v$PKG_VERSION"
-  export GOLANG=$TOOLCHAIN/lib/golang/bin/go
-  export GOPATH=$PKG_BUILD/src/github.com/syncthing/syncthing:$PKG_BUILD/vendor:$PKG_BUILD/Godeps/_workspace
-  export GOROOT=$TOOLCHAIN/lib/golang
-  export PATH=$PATH:$GOROOT/bin
 }
 
 make_target() {
