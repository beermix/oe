From 36db8444f9ea7e0331591c050897df8743d78843 Mon Sep 17 00:00:00 2001
From: MilhouseVH <milhouseVH.github@nmacleod.com>
Date: Tue, 13 Mar 2018 19:48:44 +0000
Subject: [PATCH 1/7] RPi: update to firmware 3347884

---
 packages/graphics/bcm2835-driver/package.mk  | 4 ++--
 packages/tools/bcm2835-bootloader/package.mk | 4 ++--
 2 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/packages/graphics/bcm2835-driver/package.mk b/packages/graphics/bcm2835-driver/package.mk
index 08222de1c51..4704cc11a22 100644
--- a/packages/graphics/bcm2835-driver/package.mk
+++ b/packages/graphics/bcm2835-driver/package.mk
@@ -17,8 +17,8 @@
 ################################################################################
 
 PKG_NAME="bcm2835-driver"
-PKG_VERSION="6e3c5f8"
-PKG_SHA256="201e918c5d4c3c45f9d97a01c5363861c228e547fc14b8240d975e1f46201a58"
+PKG_VERSION="3347884"
+PKG_SHA256="da520ab9608fe08f6659d5736ab53ff9ebc696a8cb37e1573773d880b0f04eaf"
 PKG_ARCH="any"
 PKG_LICENSE="nonfree"
 PKG_SITE="http://www.broadcom.com"
diff --git a/packages/tools/bcm2835-bootloader/package.mk b/packages/tools/bcm2835-bootloader/package.mk
index 8af9d6d3ea9..461e51d805f 100644
--- a/packages/tools/bcm2835-bootloader/package.mk
+++ b/packages/tools/bcm2835-bootloader/package.mk
@@ -17,8 +17,8 @@
 ################################################################################
 
 PKG_NAME="bcm2835-bootloader"
-PKG_VERSION="6e3c5f8"
-PKG_SHA256="139c5c16fc2d7fbab18803ecb32093fd12e6731e5216ea526c45a5f6f8a13474"
+PKG_VERSION="3347884"
+PKG_SHA256="75220d6477be24b7a0835e47afae5cbb33d28dc035440cf41a7bf39c403a2fec"
 PKG_ARCH="arm"
 PKG_LICENSE="nonfree"
 PKG_SITE="http://www.broadcom.com"

From 24026d8b165da9345c1435b204af7739defab275 Mon Sep 17 00:00:00 2001
From: MilhouseVH <milhouseVH.github@nmacleod.com>
Date: Wed, 14 Mar 2018 06:08:27 +0000
Subject: [PATCH 2/7] intel-ucode: update to intel-ucode-20180312

---
 packages/linux-firmware/intel-ucode/package.mk | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/packages/linux-firmware/intel-ucode/package.mk b/packages/linux-firmware/intel-ucode/package.mk
index 78e128dfa6c..b78d3b345f9 100644
--- a/packages/linux-firmware/intel-ucode/package.mk
+++ b/packages/linux-firmware/intel-ucode/package.mk
@@ -17,12 +17,12 @@
 ################################################################################
 
 PKG_NAME="intel-ucode"
-PKG_VERSION="20171117"
-PKG_SHA256="93bd1da9fa58ece0016702e657f708b7e496e56da637a3fe9a6d21f1d6f524dc"
+PKG_VERSION="20180312"
+PKG_SHA256="0b381face2df1b0a829dc4fa8fa93f47f39e11b1c9c22ebd44f8614657c1e779"
 PKG_ARCH="x86_64"
 PKG_LICENSE="other"
 PKG_SITE="https://downloadcenter.intel.com/search?keyword=linux+microcode"
-PKG_URL="https://downloadmirror.intel.com/27337/eng/microcode-${PKG_VERSION}.tgz"
+PKG_URL="https://downloadmirror.intel.com/27591/eng/microcode-${PKG_VERSION}.tgz"
 PKG_DEPENDS_HOST="toolchain"
 PKG_DEPENDS_TARGET="toolchain intel-ucode:host"
 PKG_SECTION="linux-firmware"

From d7f8e85055378ad464afa44aea5747f7764bc4af Mon Sep 17 00:00:00 2001
From: MilhouseVH <milhouseVH.github@nmacleod.com>
Date: Wed, 14 Mar 2018 18:09:49 +0000
Subject: [PATCH 3/7] linux: update to linux-4.14.26

---
 packages/linux/package.mk | 8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

diff --git a/packages/linux/package.mk b/packages/linux/package.mk
index ed03356d24a..ce463f96bc1 100644
--- a/packages/linux/package.mk
+++ b/packages/linux/package.mk
@@ -55,13 +55,13 @@ case "$LINUX" in
     PKG_SOURCE_DIR="kernel-$PKG_VERSION"
     ;;
   raspberrypi)
-    PKG_VERSION="80a14a56dacb7cc2b40d5f37d00bedb0ceace130" # 4.14.24
-    PKG_SHA256="fdf9571fe8ad514e0dd7185606828a15199f3ddb140f99ba7fcaf37dadbe8491"
+    PKG_VERSION="ad350a581a442f790b54abb81364295e937fe26b" # 4.14.26
+    PKG_SHA256="6f7d865b934f20aa7183d6cd8e6543a0a76491c5587164b9f08282bb684c6837"
     PKG_URL="https://github.com/raspberrypi/linux/archive/$PKG_VERSION.tar.gz"
     ;;
   *)
-    PKG_VERSION="4.14.24"
-    PKG_SHA256="ba512d1bd7f5910bae0f5d66554810f097f82e5df6fccb8c7cc4a11410839801"
+    PKG_VERSION="4.14.26"
+    PKG_SHA256="99a466c54261007b984ee149167d89755051dd09bfc31df37332207b0e9c6c58"
     PKG_URL="https://www.kernel.org/pub/linux/kernel/v4.x/$PKG_NAME-$PKG_VERSION.tar.xz"
     PKG_PATCH_DIRS="default"
     ;;

From 0cff189b3a65593453410ff4400fe3a48da9079c Mon Sep 17 00:00:00 2001
From: MilhouseVH <milhouseVH.github@nmacleod.com>
Date: Fri, 16 Mar 2018 13:38:50 +0000
Subject: [PATCH 4/7] linux: update to linux-4.14.27

---
 packages/linux/package.mk | 8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

diff --git a/packages/linux/package.mk b/packages/linux/package.mk
index ce463f96bc1..9af1356de0f 100644
--- a/packages/linux/package.mk
+++ b/packages/linux/package.mk
@@ -55,13 +55,13 @@ case "$LINUX" in
     PKG_SOURCE_DIR="kernel-$PKG_VERSION"
     ;;
   raspberrypi)
-    PKG_VERSION="ad350a581a442f790b54abb81364295e937fe26b" # 4.14.26
-    PKG_SHA256="6f7d865b934f20aa7183d6cd8e6543a0a76491c5587164b9f08282bb684c6837"
+    PKG_VERSION="0fefdce4ec55c6a39ca68cfd74fd3bb1612d395e" # 4.14.27
+    PKG_SHA256="6e54d92d21e9bf6cecd8d1923233366df2307c8449025902c5161279b551dd11"
     PKG_URL="https://github.com/raspberrypi/linux/archive/$PKG_VERSION.tar.gz"
     ;;
   *)
-    PKG_VERSION="4.14.26"
-    PKG_SHA256="99a466c54261007b984ee149167d89755051dd09bfc31df37332207b0e9c6c58"
+    PKG_VERSION="4.14.27"
+    PKG_SHA256="0911a449c71a06c7232ece07dfcc041bd07efaf7e67799b9e2d0cf4bd9a028ea"
     PKG_URL="https://www.kernel.org/pub/linux/kernel/v4.x/$PKG_NAME-$PKG_VERSION.tar.xz"
     PKG_PATCH_DIRS="default"
     ;;

From 07b52983ebae976182fde1aeaad7d88e66c638f6 Mon Sep 17 00:00:00 2001
From: MilhouseVH <milhouseVH.github@nmacleod.com>
Date: Fri, 16 Mar 2018 12:49:23 +0000
Subject: [PATCH 5/7] linux/RPi: stop reverting upstream Pi3 console path fix

Fixed by https://github.com/raspberrypi/linux/commit/a200c4e1f31f960db45e4601ea7e4be5eaf0e78d
---
 ..._ARM_dts_bcm283x_Fix_console_path_on_RPi3.patch | 70 ----------------------
 1 file changed, 70 deletions(-)
 delete mode 100644 packages/linux/patches/raspberrypi/linux-999-revert_ARM_dts_bcm283x_Fix_console_path_on_RPi3.patch

diff --git a/packages/linux/patches/raspberrypi/linux-999-revert_ARM_dts_bcm283x_Fix_console_path_on_RPi3.patch b/packages/linux/patches/raspberrypi/linux-999-revert_ARM_dts_bcm283x_Fix_console_path_on_RPi3.patch
deleted file mode 100644
index a6c5c70d6c4..00000000000
--- a/packages/linux/patches/raspberrypi/linux-999-revert_ARM_dts_bcm283x_Fix_console_path_on_RPi3.patch
+++ /dev/null
@@ -1,70 +0,0 @@
-From f30eeb3a0eee3f2527e09488b41ca305c8c1ac8c Mon Sep 17 00:00:00 2001
-From: MilhouseVH <milhouseVH.github@nmacleod.com>
-Date: Fri, 1 Dec 2017 20:13:51 +0000
-Subject: [PATCH] Revert "ARM: dts: bcm283x: Fix console path on RPi3"
-
-This reverts commit f08f58a2bf68900a84e782b8c7ad701c0654173c.
----
- arch/arm/boot/dts/bcm2835-rpi-zero-w.dts | 9 ++++++---
- arch/arm/boot/dts/bcm2837-rpi-3-b.dts    | 5 -----
- arch/arm/boot/dts/bcm283x.dtsi           | 7 +------
- 3 files changed, 7 insertions(+), 14 deletions(-)
-
-diff --git a/arch/arm/boot/dts/bcm2835-rpi-zero-w.dts b/arch/arm/boot/dts/bcm2835-rpi-zero-w.dts
-index b8565fc..82651c3 100644
---- a/arch/arm/boot/dts/bcm2835-rpi-zero-w.dts
-+++ b/arch/arm/boot/dts/bcm2835-rpi-zero-w.dts
-@@ -18,9 +18,12 @@
- 	compatible = "raspberrypi,model-zero-w", "brcm,bcm2835";
- 	model = "Raspberry Pi Zero W";
- 
--	chosen {
--		/* 8250 auxiliary UART instead of pl011 */
--		stdout-path = "serial1:115200n8";
-+	/* Needed by firmware to properly init UARTs */
-+	aliases {
-+		uart0 = "/soc/serial@7e201000";
-+		uart1 = "/soc/serial@7e215040";
-+		serial0 = "/soc/serial@7e201000";
-+		serial1 = "/soc/serial@7e215040";
- 	};
- 
- 	leds {
-diff --git a/arch/arm/boot/dts/bcm2837-rpi-3-b.dts b/arch/arm/boot/dts/bcm2837-rpi-3-b.dts
-index eb1a28d..b375f40 100644
---- a/arch/arm/boot/dts/bcm2837-rpi-3-b.dts
-+++ b/arch/arm/boot/dts/bcm2837-rpi-3-b.dts
-@@ -9,11 +9,6 @@
- 	compatible = "raspberrypi,3-model-b", "brcm,bcm2837";
- 	model = "Raspberry Pi 3 Model B";
- 
--	chosen {
--		/* 8250 auxiliary UART instead of pl011 */
--		stdout-path = "serial1:115200n8";
--	};
--
- 	memory {
- 		reg = <0 0x40000000>;
- 	};
-diff --git a/arch/arm/boot/dts/bcm283x.dtsi b/arch/arm/boot/dts/bcm283x.dtsi
-index 013431e..431dcfc 100644
---- a/arch/arm/boot/dts/bcm283x.dtsi
-+++ b/arch/arm/boot/dts/bcm283x.dtsi
-@@ -20,13 +20,8 @@
- 	#address-cells = <1>;
- 	#size-cells = <1>;
- 
--	aliases {
--		serial0 = &uart0;
--		serial1 = &uart1;
--	};
--
- 	chosen {
--		stdout-path = "serial0:115200n8";
-+		bootargs = "earlyprintk console=ttyAMA0";
- 	};
- 
- 	thermal-zones {
--- 
-2.14.1
-

From 2fb5fe708d068c216c13a6b7d9d36b0d8542ce22 Mon Sep 17 00:00:00 2001
From: MilhouseVH <milhouseVH.github@nmacleod.com>
Date: Fri, 16 Mar 2018 13:57:15 +0000
Subject: [PATCH 6/7] config: update options for 4.14.27

---
 projects/Generic/linux/linux.x86_64.conf | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/projects/Generic/linux/linux.x86_64.conf b/projects/Generic/linux/linux.x86_64.conf
index b964200325f..84ff66ac3d7 100644
--- a/projects/Generic/linux/linux.x86_64.conf
+++ b/projects/Generic/linux/linux.x86_64.conf
@@ -1,6 +1,6 @@
 #
 # Automatically generated file; DO NOT EDIT.
-# Linux/x86_64 4.14.22 Kernel Configuration
+# Linux/x86_64 4.14.27 Kernel Configuration
 #
 CONFIG_64BIT=y
 CONFIG_X86_64=y
@@ -321,6 +321,7 @@ CONFIG_ARCH_MMAP_RND_COMPAT_BITS=8
 CONFIG_HAVE_ARCH_COMPAT_MMAP_BASES=y
 CONFIG_HAVE_COPY_THREAD_TLS=y
 CONFIG_HAVE_STACK_VALIDATION=y
+CONFIG_HAVE_RELIABLE_STACKTRACE=y
 # CONFIG_HAVE_ARCH_HASH is not set
 # CONFIG_ISA_BUS_API is not set
 CONFIG_OLD_SIGSUSPEND3=y
@@ -4999,7 +5000,7 @@ CONFIG_DEBUG_FS=y
 # CONFIG_DEBUG_SECTION_MISMATCH is not set
 CONFIG_SECTION_MISMATCH_WARN_ONLY=y
 CONFIG_FRAME_POINTER=y
-# CONFIG_STACK_VALIDATION is not set
+CONFIG_STACK_VALIDATION=y
 # CONFIG_DEBUG_FORCE_WEAK_PER_CPU is not set
 CONFIG_MAGIC_SYSRQ=y
 CONFIG_MAGIC_SYSRQ_DEFAULT_ENABLE=0x1

From bbdb6c52f8f7e7b630a2b27e58c1198f13177397 Mon Sep 17 00:00:00 2001
From: MilhouseVH <milhouseVH.github@nmacleod.com>
Date: Fri, 16 Mar 2018 13:54:56 +0000
Subject: [PATCH 7/7] RPi: update to firmware 086a848

---
 packages/graphics/bcm2835-driver/package.mk  | 4 ++--
 packages/tools/bcm2835-bootloader/package.mk | 4 ++--
 2 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/packages/graphics/bcm2835-driver/package.mk b/packages/graphics/bcm2835-driver/package.mk
index 4704cc11a22..966a7e185be 100644
--- a/packages/graphics/bcm2835-driver/package.mk
+++ b/packages/graphics/bcm2835-driver/package.mk
@@ -17,8 +17,8 @@
 ################################################################################
 
 PKG_NAME="bcm2835-driver"
-PKG_VERSION="3347884"
-PKG_SHA256="da520ab9608fe08f6659d5736ab53ff9ebc696a8cb37e1573773d880b0f04eaf"
+PKG_VERSION="086a848"
+PKG_SHA256="cb45e24c497d56f92499a668abb9afb3e358b4a5b29dd4c878535e271af01b3f"
 PKG_ARCH="any"
 PKG_LICENSE="nonfree"
 PKG_SITE="http://www.broadcom.com"
diff --git a/packages/tools/bcm2835-bootloader/package.mk b/packages/tools/bcm2835-bootloader/package.mk
index 461e51d805f..aa5b366729e 100644
--- a/packages/tools/bcm2835-bootloader/package.mk
+++ b/packages/tools/bcm2835-bootloader/package.mk
@@ -17,8 +17,8 @@
 ################################################################################
 
 PKG_NAME="bcm2835-bootloader"
-PKG_VERSION="3347884"
-PKG_SHA256="75220d6477be24b7a0835e47afae5cbb33d28dc035440cf41a7bf39c403a2fec"
+PKG_VERSION="086a848"
+PKG_SHA256="647b85361b19ab938988ae4f98393fa1f52a604b9aafa3b19d8b0567c57aee6f"
 PKG_ARCH="arm"
 PKG_LICENSE="nonfree"
 PKG_SITE="http://www.broadcom.com"
