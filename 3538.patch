From 99736ece8416a73fb07578f120ea5868ccea893d Mon Sep 17 00:00:00 2001
From: kszaq <kszaquitto@gmail.com>
Date: Wed, 29 May 2019 22:43:00 +0200
Subject: [PATCH 1/2] init: ondemand tuning

Set all ondemand tunables like it's done for RPi.
Thanks to these GUI animations feel smoother,
particularly on ARM targets.
---
 packages/sysutils/busybox/scripts/init | 15 +++++++--------
 1 file changed, 7 insertions(+), 8 deletions(-)

diff --git a/packages/sysutils/busybox/scripts/init b/packages/sysutils/busybox/scripts/init
index 52bb05b7aa3..c2e6db20ec2 100755
--- a/packages/sysutils/busybox/scripts/init
+++ b/packages/sysutils/busybox/scripts/init
@@ -930,14 +930,13 @@ prepare_sysroot() {
 # hide kernel log messages on console
 echo '1 4 1 7' > /proc/sys/kernel/printk
 
-# set ondemand up_threshold
-if [ -e /sys/devices/system/cpu/cpufreq/ondemand/up_threshold ]; then
-  echo 50 > /sys/devices/system/cpu/cpufreq/ondemand/up_threshold
-else
-  for f in $(ls /sys/devices/system/cpu/cpufreq/policy*/ondemand/up_threshold 2>/dev/null) ; do
-    echo 50 > $f
-  done
-fi
+# Configure frequency scaling properties
+for policy in $(find /sys/devices/system/cpu/cpufreq -name ondemand 2>/dev/null) ; do
+  echo 1 > $policy/io_is_busy
+  echo 50 > $policy/up_threshold
+  echo 100000 > $policy/sampling_rate
+  echo 50 > $policy/sampling_down_factor
+done
 
 # run platform_init script if exists
 if [ -f "./platform_init" ]; then

From a604ccf718340ba1cf978cb28ee402885a755f3a Mon Sep 17 00:00:00 2001
From: kszaq <kszaquitto@gmail.com>
Date: Wed, 29 May 2019 22:44:18 +0200
Subject: [PATCH 2/2] RPi: remove platform_init, tunables are set in init

---
 projects/RPi/initramfs/platform_init | 13 -------------
 1 file changed, 13 deletions(-)
 delete mode 100755 projects/RPi/initramfs/platform_init

diff --git a/projects/RPi/initramfs/platform_init b/projects/RPi/initramfs/platform_init
deleted file mode 100755
index b44e1dcfd46..00000000000
--- a/projects/RPi/initramfs/platform_init
+++ /dev/null
@@ -1,13 +0,0 @@
-#!/bin/sh
-
-# SPDX-License-Identifier: GPL-2.0-or-later
-# Copyright (C) 2009-2015 Stephan Raue (stephan@openelec.tv)
-
-# Enable io_is_busy for improved sdhost performance - essentially, equivalent of force_turbo=1 but for mmc
-echo 1 > /sys/devices/system/cpu/cpufreq/ondemand/io_is_busy
-
-# Configure frequency scaling properties - should improve performance a little (turbo, in most cases)
-echo ondemand > /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
-echo 50 > /sys/devices/system/cpu/cpufreq/ondemand/up_threshold
-echo 100000 > /sys/devices/system/cpu/cpufreq/ondemand/sampling_rate
-echo 50 > /sys/devices/system/cpu/cpufreq/ondemand/sampling_down_factor
