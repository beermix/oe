#!/bin/sh

# SPDX-License-Identifier: GPL-2.0-or-later
# Copyright (C) 2009-2015 Stephan Raue (stephan@openelec.tv)
# Copyright (C) 2019-present Team LibreELEC (https://libreelec.tv)

# Set cpu governor to ondemand if available
if [ $( grep -c "ondemand" /sys/devices/system/cpu/cpufreq/policy0/scaling_available_governors ) -ge 1 ]; then
  echo ondemand > /sys/devices/system/cpu/cpufreq/policy0/scaling_governor

  # Configure frequency scaling properties
  echo 1 > /sys/devices/system/cpu/cpufreq/ondemand/io_is_busy
  echo 50 > /sys/devices/system/cpu/cpufreq/ondemand/up_threshold
  echo 100000 > /sys/devices/system/cpu/cpufreq/ondemand/sampling_rate
  echo 50 > /sys/devices/system/cpu/cpufreq/ondemand/sampling_down_factor
else
  echo "set-cpufreq: No suitable cpufreq governor found." | systemd-cat -p info
fi
