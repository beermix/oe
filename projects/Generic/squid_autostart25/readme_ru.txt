============================================================
Squid autostart Install & Remove   (C) 2007,2015 Yuri Voinov
============================================================

***  ВНИМАНИЕ!   Пакет   по  умолчанию  настроен  на  запуск
Squid, установленный в /usr/local!

***    ВНИМАНИЕ!  Данная  версия  рассчитана на запуск Squid
от     пользователя     root!          После         запуска
происходит                понижение               привилегий
до cache_effective_user.

***  Замечание:  По  умолчанию  включена  запись  лога  кэша
в cache.log. Для включения записи лога в SYSLOG используется
опция TO_SYSLOG в init.squid.

Данный  набор скриптов предназначен для установки и удаления
сервиса SMF для Squid на Sun Solaris 10 и выше и Linux (SysV
init).

Все  необходимые  пререквизиты,   необходимые   для  запуска
сервиса   Squid,  согласно   руководсту  по конфигурированию
(исключая  конфигурирование  собственно Squid) выполняются в
процессе   установки  сервиса,  удаление серсива SMF удаляет
все   скрипты,  выполняет разрегистрацию сервиса Squid и его
остановку.

***  Внимание! cache_effective_user должен быть создан перед
запуском   сервиса.   Пользователь    не   удаляется   и  не
создается данным набором скриптов.

Для активизации Squid SMF выполните следующие шаги:
---------------------------------------------------

0. ВАЖНО! Если Сквид использует редиректор squidGuard, важно
помнить,  что  он  требует BerkeleyDB. Путь к которой должен
быть  задан  в еременной LD_ADD файла init.squid. Если squid
user  имеет  установленный  шелл  bash,  то  убедитесь,  что
путь   к  BDB  корректно  задан   в   init.squid (переменная
LD_ADD).  В  противном  случае,   при  использовании bash  с
исправленным  Shellchoke,  запуск   squid  будет невозможен.
Если  версия BDB  обновилась, и   при  этом изменился путь к
ней    -    убедитесь,   что   значение   переменной     BDB
соответствующим  образом  скорректировано. Также   в  данной
ситуации    убедитесь,   что  в  глобальном конфигурационном
файле /var/ld/ld.config путь к BDB присутствует.

1.  Установите  Squid и все необходимые библиотеки, если это
еще не сделано.

2. Сконфигурируйте Squid.

3.  При  необходимости, отредактируйте параметр (переменную)
BASE_DIR  в  скрипте  init.squid,  чтобы  она  указывала  на
директорию, в которой реально установлен Squid.

***  ВНИМАНИЕ!   Пакет   по  умолчанию  настроен  на  запуск
Squid, установленный в /usr/local!

4.   Запустите   скрипт   install.sh, который и выполнит все
необходимые     пререквизиты      и      постинсталляционные
действия и установит Squid автостарт сервис.

5.  Выполните команду  svcadm enable squid для активизации и
старта сервиса Squid на Solaris. Для Linux перезапустите хост
либо выполните /etc/init.d/init.squid start

Для деактивации и удаления Squid сервиса автозапуска выполните
--------------------------------------------------------------
следующие шаги:
---------------

1.Запустите   скрипт   remove.sh  . Скрипт останавливает все
работающие   процессы   Squid,  рарзегистрирует  SMF сервис,
полностью      удаляет     Squid     SMF     и    откатывает
операции,  выполненные  ранее  при  активизации  сервиса; на
Linux выполняется корректное удаление сервиса и скрипта.

***    Замечание:     Удаление  сервиса автозапуска Squid не
приводит  к    удалению    установленного    ПО   Squid  или
пользователя cache_effective_user!

Сервис SMF поддерживает следующие методы:
-----------------------------------------
svcadm squid enabe/disable/refresh/restart

ВНИМАНИЕ!
---------
При    необходимости   внесения   изменений  в  конфигурацию
запуска    Squid    следует    отредактировать   необходимые
переменные в скрипте init.squid:

# Base Squid installation directory
BASE_DIR="/usr/local/squid"

# Squid files paths
SQUID_PATH="$BASE_DIR""/sbin"
SQUID_CONF_PATH="$BASE_DIR""/etc"

# Squid files
SQUID_BIN_FILE="squid"
SQUID_CONF_FILE="squid.conf"

# Squid effective user name
SQUID_USER="squid"

# Set file descriptors limit. See --with-maxfd/--with-filedescriptors option with squid configuration
MAXFD=131072

# LD_LIBRARY_PATH additional setting. Change if another bdb version is installed. Bdb uses by squidGuard
LD_ADD="/opt/csw/bdb48/lib/amd64:/opt/csw/lib/amd64"

# Log cache to syslog
# Set to Y, if your need
TO_SYSLOG="N"

Поддерживается  работа  в режиме ограничения RSS-max службой
rcap,  и /etc/project. Если существует запись в /etc/project
с именем
user.squid:100:Squid processes:squid:squid:rcap.max-rss=<значение>
и   служба  rcap  запущена   -   максимальная   память   RSS
процессов Squid будет ограничиваться заданным значением.

Архив содержит:

init.squid               - Управляющий метод Squid autostart
squid.xml                     - Сервисный манифест Squid SMF
readme_en.txt                          - This file (English)
readme_ru.txt                          - Этот файл (Russian)
install.sh             - Установочный скрипт Squid autostart
remove.sh.sh               - Скрипт удаления Squid autostart

============================================================
Squid autostart Install & Remove   (C) 2007,2015 Yuri Voinov
============================================================