From c92d648e1c34d5dd900785eb11ec4c975bd6a4c9 Mon Sep 17 00:00:00 2001
From: Ian Leonard <antonlacon@gmail.com>
Date: Thu, 18 Jul 2019 17:45:17 +0000
Subject: [PATCH 1/2] edid-debug: fix build when not using gold

Signed-off-by: Ian Leonard <antonlacon@gmail.com>
---
 packages/debug/edid-decode/package.mk | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/packages/debug/edid-decode/package.mk b/packages/debug/edid-decode/package.mk
index 854ba767b96..ab208802726 100644
--- a/packages/debug/edid-decode/package.mk
+++ b/packages/debug/edid-decode/package.mk
@@ -11,8 +11,8 @@ PKG_DEPENDS_TARGET="toolchain"
 PKG_LONGDESC="Decode EDID data in human-readable format"
 
 make_target() {
-  echo "$CC $CFLAGS -Wall $LDFLAGS -lm -o edid-decode edid-decode.c"
-  $CC $CFLAGS -Wall $LDFLAGS -lm -o edid-decode edid-decode.c
+  echo "$CC $CFLAGS -Wall $LDFLAGS -o edid-decode edid-decode.c -lm"
+  $CC $CFLAGS -Wall $LDFLAGS -o edid-decode edid-decode.c -lm
 }
 
 makeinstall_target() {

From b68a78b3ffd995b98d32b99807d4926f87056885 Mon Sep 17 00:00:00 2001
From: Ian Leonard <antonlacon@gmail.com>
Date: Thu, 18 Jul 2019 18:01:00 +0000
Subject: [PATCH 2/2] curl: enable libidn2, update configure

enable libidn2 usage (libidn deprecated and no longer available)
polarssl renamed to mbedtls
no complaints regarding clock_gettime

Signed-off-by: Ian Leonard <antonlacon@gmail.com>
---
 packages/web/curl/package.mk | 14 ++++----------
 1 file changed, 4 insertions(+), 10 deletions(-)

diff --git a/packages/web/curl/package.mk b/packages/web/curl/package.mk
index c6790060676..58335202a4b 100644
--- a/packages/web/curl/package.mk
+++ b/packages/web/curl/package.mk
@@ -16,7 +16,7 @@ PKG_SHA256="f6c22074877f235aebc7c53057dbc7ee82358f8ae58bfb767e955c18c859a77a"
 PKG_LICENSE="MIT"
 PKG_SITE="http://curl.haxx.se"
 PKG_URL="http://curl.haxx.se/download/$PKG_NAME-$PKG_VERSION.tar.xz"
-PKG_DEPENDS_TARGET="toolchain zlib gnutls rtmpdump nghttp2"
+PKG_DEPENDS_TARGET="toolchain zlib gnutls rtmpdump libidn2 nghttp2"
 PKG_LONGDESC="Client and library for (HTTP, HTTPS, FTP, ...) transfers."
 PKG_TOOLCHAIN="configure"
 
@@ -65,23 +65,17 @@ PKG_CONFIGURE_OPTS_TARGET="ac_cv_lib_rtmp_RTMP_Init=yes \
                            --with-random=/dev/urandom \
                            --with-gnutls \
                            --without-ssl \
-                           --without-polarssl \
+                           --without-mbedtls \
                            --without-nss \
                            --with-ca-bundle=/run/libreelec/cacert.pem \
                            --without-ca-path \
                            --without-libpsl \
                            --without-libmetalink \
                            --without-libssh2 \
-                           --with-librtmp=$SYSROOT_PREFIX/usr \
-                           --without-libidn \
-                           --without-libidn2 \
+                           --with-librtmp \
+                           --with-libidn2 \
                            --with-nghttp2"
 
-pre_configure_target() {
-# link against librt because of undefined reference to 'clock_gettime'
-  export LIBS="-lrt -lm -lrtmp"
-}
-
 post_makeinstall_target() {
   rm -rf $INSTALL/usr/share/zsh
   rm -rf $INSTALL/usr/bin/curl-config
