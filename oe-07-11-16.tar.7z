From d481e131082afdbe4f7507c71484e4648a262ae7 Mon Sep 17 00:00:00 2001
From: mglae <mglmail@arcor.de>
Date: Sun, 19 Feb 2017 17:56:21 +0100
Subject: [PATCH 1/2] busybox: fix fs-resize by using sgdisk

---
 packages/sysutils/busybox/package.mk        | 2 +-
 packages/sysutils/busybox/scripts/fs-resize | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/packages/sysutils/busybox/package.mk b/packages/sysutils/busybox/package.mk
index 9e63435..0b2d331 100644
--- a/packages/sysutils/busybox/package.mk
+++ b/packages/sysutils/busybox/package.mk
@@ -23,7 +23,7 @@ PKG_LICENSE="GPL"
 PKG_SITE="http://www.busybox.net"
 PKG_URL="http://busybox.net/downloads/$PKG_NAME-$PKG_VERSION.tar.bz2"
 PKG_DEPENDS_HOST=""
-PKG_DEPENDS_TARGET="toolchain busybox:host hdparm dosfstools e2fsprogs zip unzip pciutils usbutils parted procps-ng"
+PKG_DEPENDS_TARGET="toolchain busybox:host hdparm dosfstools e2fsprogs zip unzip pciutils usbutils parted procps-ng gptfdisk"
 PKG_DEPENDS_INIT="toolchain"
 PKG_SECTION="system"
 PKG_SHORTDESC="BusyBox: The Swiss Army Knife of Embedded Linux"
diff --git a/packages/sysutils/busybox/scripts/fs-resize b/packages/sysutils/busybox/scripts/fs-resize
index a6b9692..ce52791 100755
--- a/packages/sysutils/busybox/scripts/fs-resize
+++ b/packages/sysutils/busybox/scripts/fs-resize
@@ -63,7 +63,7 @@ if [ -e /storage/.please_resize_me ] ; then
       echo ""
 
       # fix any minor issues, such as gpt header not at end of disk
-      StartProgress spinner "Checking layout...   " "parted $DISK print fix &>/dev/null"
+      StartProgress spinner "Checking layout...   " "sgdisk -e $DISK &>/dev/null"
 
       StartProgress spinner "Deleting /storage... " "parted -s -m $DISK rm 2 &>/dev/null"
       StartProgress spinner "Creating /storage... " "parted -s -m $DISK unit b mkpart primary $PART_START 100% &>/dev/null"

From b5d6ddb7c5ba44fd321ccea8f37a1fde7bb514e1 Mon Sep 17 00:00:00 2001
From: mglae <mglmail@arcor.de>
Date: Mon, 20 Feb 2017 23:31:10 +0100
Subject: [PATCH 2/2] gptfdisk: new package providing sgdisk

---
 packages/sysutils/gptfdisk/package.mk | 39 +++++++++++++++++++++++++++++++++++
 1 file changed, 39 insertions(+)
 create mode 100644 packages/sysutils/gptfdisk/package.mk

diff --git a/packages/sysutils/gptfdisk/package.mk b/packages/sysutils/gptfdisk/package.mk
new file mode 100644
index 0000000..434e120
--- /dev/null
+++ b/packages/sysutils/gptfdisk/package.mk
@@ -0,0 +1,39 @@
+################################################################################
+#      This file is part of LibreELEC - https://libreelec.tv
+#      Copyright (C) 2017 Team LibreELEC
+#
+#  LibreELEC is free software: you can redistribute it and/or modify
+#  it under the terms of the GNU General Public License as published by
+#  the Free Software Foundation, either version 2 of the License, or
+#  (at your option) any later version.
+#
+#  LibreELEC is distributed in the hope that it will be useful,
+#  but WITHOUT ANY WARRANTY; without even the implied warranty of
+#  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+#  GNU General Public License for more details.
+#
+#  You should have received a copy of the GNU General Public License
+#  along with LibreELEC.  If not, see <http://www.gnu.org/licenses/>.
+################################################################################
+
+PKG_NAME="gptfdisk"
+PKG_VERSION="1.0.1"
+PKG_ARCH="any"
+PKG_LICENSE="GPL"
+PKG_SITE="http://www.rodsbooks.com/gdisk/"
+PKG_URL="https://downloads.sourceforge.net/project/$PKG_NAME/$PKG_NAME/$PKG_VERSION/$PKG_NAME-$PKG_VERSION.tar.gz"
+PKG_DEPENDS_TARGET="toolchain popt"
+PKG_SECTION="system"
+PKG_SHORTDESC="GPT text-mode partitioning tools"
+PKG_LONGDESC="GPT text-mode partitioning tools"
+PKG_IS_ADDON="no"
+PKG_AUTORECONF="no"
+
+make_target() {
+  make sgdisk "CC=$CC" "CXX=$CXX"
+}
+
+makeinstall_target() {
+  mkdir -p $INSTALL/usr/sbin/
+    cp -p sgdisk $INSTALL/usr/sbin/
+}
