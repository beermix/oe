From 71795174a75f4aa2fb1291ea92a37ed4a815b035 Mon Sep 17 00:00:00 2001
From: Maarten Lankhorst <maarten.lankhorst@canonical.com>
Date: Sat, 31 Aug 2013 08:36:02 +0200
Subject: [PATCH 35/41] dsound: fixup DSOUND_WaveQueue checks

If you're going to be silly, you should go all the way. :P
---
 dlls/dsound/mixer.c | 10 ++++++----
 1 file changed, 6 insertions(+), 4 deletions(-)

Index: wine1.6-1.7.1-actually1.6/dlls/dsound/mixer.c
===================================================================
--- wine1.6-1.7.1-actually1.6.orig/dlls/dsound/mixer.c	2013-09-13 16:19:21.423219812 -0700
+++ wine1.6-1.7.1-actually1.6/dlls/dsound/mixer.c	2013-09-13 16:19:44.000000000 -0700
@@ -580,16 +580,18 @@
 	hr = IAudioRenderClient_GetBuffer(device->render, bytes / device->pwfx->nBlockAlign, &buffer);
 	if(FAILED(hr)){
 		WARN("GetBuffer failed: %08x\n", hr);
-		goto done;
+		return;
 	}
 
 	memcpy(buffer, pos, bytes);
 
 	hr = IAudioRenderClient_ReleaseBuffer(device->render, bytes / device->pwfx->nBlockAlign, 0);
-	if(FAILED(hr))
-		WARN("ReleaseBuffer failed: %08x\n", hr);
+	if(FAILED(hr)) {
+		ERR("ReleaseBuffer failed: %08x\n", hr);
+		IAudioRenderClient_ReleaseBuffer(device->render, 0, 0);
+		return;
+	}
 
-done:
 	device->pad += bytes;
 }
 
