From 33fa776e9ac616fe2ef9064c9a85f3fb5cbfe2fd Mon Sep 17 00:00:00 2001
From: Maarten Lankhorst <maarten.lankhorst@canonical.com>
Date: Sat, 31 Aug 2013 08:36:02 +0200
Subject: [PATCH 26/41] winepulse: disable the setevent part of the latency
 hack

If you get playback glitches in skyrim or other games as a result of
this patch, PLEASE REPORT TO ME!
---
 dlls/winepulse.drv/mmdevdrv.c | 8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

Index: wine1.6-1.7.1-actually1.6/dlls/winepulse.drv/mmdevdrv.c
===================================================================
--- wine1.6-1.7.1-actually1.6.orig/dlls/winepulse.drv/mmdevdrv.c	2013-09-13 16:19:09.000000000 -0700
+++ wine1.6-1.7.1-actually1.6/dlls/winepulse.drv/mmdevdrv.c	2013-09-13 16:19:50.000000000 -0700
@@ -1822,7 +1822,7 @@
 {
     ACImpl *This = impl_from_IAudioRenderClient(iface);
     UINT32 written_bytes = written_frames * pa_frame_size(&This->ss);
-    UINT32 period;
+//    UINT32 period;
 
     TRACE("(%p)->(%u, %x)\n", This, written_frames, flags);
 
@@ -1858,10 +1858,10 @@
     TRACE("Released %u, pad %zu\n", written_frames, This->pad / pa_frame_size(&This->ss));
     assert(This->pad <= This->bufsize_bytes);
 
-    period = pa_stream_get_buffer_attr(This->stream)->minreq;
+//    period = pa_stream_get_buffer_attr(This->stream)->minreq;
     /* Require a minimum of 3 periods filled, if possible */
-    if (This->event && This->pad + period <= This->bufsize_bytes && This->pad < period * 3)
-        SetEvent(This->event);
+//    if (This->event && This->pad + period <= This->bufsize_bytes && This->pad < period * 3)
+//        SetEvent(This->event);
     pthread_mutex_unlock(&pulse_lock);
     return S_OK;
 }
