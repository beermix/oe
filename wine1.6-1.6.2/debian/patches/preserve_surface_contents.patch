From e5ef460d7dc9c9739da92349eb5d6bf827d7ce8b Mon Sep 17 00:00:00 2001
From: Alexandre Julliard <julliard@winehq.org>
Date: Wed, 9 Dec 2015 20:10:24 +0900
Subject: [PATCH] user32: Preserve the surface contents when changing the
 WS_EX_LAYERED bit.

Signed-off-by: Alexandre Julliard <julliard@winehq.org>
---
 dlls/user32/win.c | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

Index: wine1.6-1.6.2/dlls/user32/win.c
===================================================================
--- wine1.6-1.6.2.orig/dlls/user32/win.c	2015-12-18 19:01:05.564982992 -0500
+++ wine1.6-1.6.2/dlls/user32/win.c	2015-12-18 19:01:05.560982951 -0500
@@ -437,11 +437,13 @@
  */
 static void update_window_state( HWND hwnd )
 {
-    RECT window_rect, client_rect;
+    RECT window_rect, client_rect, valid_rects[2];
 
     WIN_GetRectangles( hwnd, COORDS_PARENT, &window_rect, &client_rect );
+    valid_rects[0] = valid_rects[1] = client_rect;
     set_window_pos( hwnd, 0, SWP_NOSIZE | SWP_NOMOVE | SWP_NOCLIENTSIZE | SWP_NOCLIENTMOVE |
-                    SWP_NOZORDER | SWP_NOACTIVATE | SWP_NOREDRAW, &window_rect, &client_rect, NULL );
+                    SWP_NOZORDER | SWP_NOACTIVATE | SWP_NOREDRAW,
+                    &window_rect, &client_rect, valid_rects );
 }
 
 
