From 88534b8fb4b6e3ae6493b41c7030395df3f9ee6c Mon Sep 17 00:00:00 2001
From: Nikos Mavrogiannopoulos <nmav@redhat.com>
Date: Fri, 3 Feb 2017 23:11:27 +0100
Subject: [PATCH] gnutls_pkcs11_obj_list_import_url4: always return an
 initialized pointer

When returning success, but no elements, gnutls_pkcs11_obj_list_import_url4,
could have returned zero number of elements with a pointer that was uninitialized.
Ensure that an initialized (i.e., null in that case), pointer is always returned.
Reported by Jeremy Harris.

Signed-off-by: Nikos Mavrogiannopoulos <nmav@redhat.com>
---
 lib/pkcs11.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/lib/pkcs11.c b/lib/pkcs11.c
index 21f8bc3dd..2473a4c75 100644
--- a/lib/pkcs11.c
+++ b/lib/pkcs11.c
@@ -3138,6 +3138,7 @@ gnutls_pkcs11_obj_list_import_url4(gnutls_pkcs11_obj_t ** p_list,
 	if (ret < 0) {
 		gnutls_assert();
 		if (ret == GNUTLS_E_REQUESTED_DATA_NOT_AVAILABLE) {
+			*p_list = NULL;
 			*n_list = 0;
 			ret = 0;
 		}
-- 
2.11.0

